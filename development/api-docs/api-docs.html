<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMP CheckMaster AI - API 문서</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .api-section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .api-endpoint {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
            border-radius: 4px;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
        }
        .method.get { background: #28a745; color: white; }
        .method.post { background: #007bff; color: white; }
        .method.put { background: #ffc107; color: black; }
        .method.delete { background: #dc3545; color: white; }
        .code {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
        }
        .status-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .nav {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .nav a {
            color: #007bff;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 500;
        }
        .nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏭 GMP CheckMaster AI</h1>
        <p>제약업계 위생상태 점검 시스템 API 문서</p>
        <div style="margin-top: 20px;">
            <span class="status-badge">26개 API</span>
            <span class="status-badge">100% 테스트 완료</span>
            <span class="status-badge">클라우드 배포</span>
        </div>
    </div>

    <div class="nav">
        <a href="#overview">개요</a>
        <a href="#auth">인증</a>
        <a href="#checklist">체크리스트</a>
        <a href="#ai">AI 판정</a>
        <a href="#qr">QR 코드</a>
        <a href="#dashboard">대시보드</a>
        <a href="#assignment">배정 관리</a>
        <a href="#notification">알림</a>
        <a href="#admin">관리자</a>
        <a href="#action">조치 관리</a>
    </div>

    <div id="overview" class="api-section">
        <h2>📋 API 개요</h2>
        <p><strong>Base URL:</strong> <code>https://ncrceaq64l.execute-api.us-east-1.amazonaws.com/dev</code></p>
        <p><strong>총 API 수:</strong> 26개</p>
        <p><strong>핸들러 수:</strong> 9개</p>
        <p><strong>테스트 커버리지:</strong> 100%</p>
        
        <h3>🎯 빠른 테스트</h3>
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/auth/login</code>
            <button class="test-button" onclick="testLogin()">테스트</button>
        </div>
        <div class="code" id="login-result">결과가 여기에 표시됩니다...</div>
    </div>

    <div id="auth" class="api-section">
        <h2>🔐 1. 인증 API (3개)</h2>
        
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/auth/login</code>
            <p>사용자 로그인 및 JWT 토큰 발급</p>
            <div class="code">
{
  "user_id": "worker1",
  "password": "demo123"
}
            </div>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/auth/logout</code>
            <p>사용자 로그아웃</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/auth/verify</code>
            <p>JWT 토큰 검증</p>
        </div>
    </div>

    <div id="checklist" class="api-section">
        <h2>📋 2. 체크리스트 API (6개)</h2>
        
        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/checklists/templates</code>
            <p>위생상태 점검표 템플릿 조회 (9개 항목)</p>
            <button class="test-button" onclick="testTemplates()">테스트</button>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/checklists/submit</code>
            <p>체크리스트 제출</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/checklists/records</code>
            <p>체크리스트 기록 조회</p>
        </div>

        <div class="api-endpoint">
            <span class="method put">PUT</span>
            <code>/checklists/records/{id}</code>
            <p>체크리스트 수정 (5분 내)</p>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/checklists/modification-request</code>
            <p>수정 요청 (5분 후)</p>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/checklists/emergency-review</code>
            <p>긴급 재검토 요청</p>
        </div>
    </div>

    <div id="ai" class="api-section">
        <h2>🤖 3. AI 판정 API (2개)</h2>
        
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/ai/judge</code>
            <p>건강상태 AI 판정 (4단계: 승인/거부/재확인/대기)</p>
            <button class="test-button" onclick="testAI()">테스트</button>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/ai/judgment/{id}</code>
            <p>AI 판정 결과 상세 조회</p>
        </div>
    </div>

    <div id="qr" class="api-section">
        <h2>📱 4. QR 코드 API (2개)</h2>
        
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/qr/generate</code>
            <p>QR 코드 생성 (8시간 유효)</p>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/qr/verify</code>
            <p>QR 코드 검증 및 출입 허가</p>
        </div>
    </div>

    <div id="dashboard" class="api-section">
        <h2>📊 5. 대시보드 API (4개)</h2>
        
        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/dashboard/stats</code>
            <p>통계 조회 (완료율, 부적합률 등)</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/dashboard/reports</code>
            <p>리포트 조회</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/dashboard/status</code>
            <p>실시간 현황 조회 (운영자용)</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/dashboard/team/{id}</code>
            <p>팀 현황 조회 (책임자용)</p>
        </div>
    </div>

    <div id="assignment" class="api-section">
        <h2>📝 6. 배정 관리 API (2개)</h2>
        
        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/assignment/list</code>
            <p>사용자별 체크리스트 배정 목록</p>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/assignment/create</code>
            <p>새로운 배정 생성</p>
        </div>
    </div>

    <div id="notification" class="api-section">
        <h2>🔔 7. 알림 API (1개)</h2>
        
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/notification/send</code>
            <p>알림 발송 (마감 알림, 상태 변경 등)</p>
        </div>
    </div>

    <div id="admin" class="api-section">
        <h2>⚙️ 8. 관리자 API (3개)</h2>
        
        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/admin/templates</code>
            <p>체크리스트 템플릿 생성</p>
        </div>

        <div class="api-endpoint">
            <span class="method put">PUT</span>
            <code>/admin/qr-validity/template/{id}</code>
            <p>QR 유효시간 설정</p>
        </div>

        <div class="api-endpoint">
            <span class="method put">PUT</span>
            <code>/operator/qr-validity/daily</code>
            <p>QR 유효시간 당일 조정</p>
        </div>
    </div>

    <div id="action" class="api-section">
        <h2>🚨 9. 조치 관리 API (4개)</h2>
        
        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/actions/list</code>
            <p>부적합자 조치 목록 조회</p>
        </div>

        <div class="api-endpoint">
            <span class="method put">PUT</span>
            <code>/actions/{record_id}/status</code>
            <p>조치 상태 업데이트</p>
        </div>

        <div class="api-endpoint">
            <span class="method post">POST</span>
            <code>/actions/{record_id}/complete</code>
            <p>조치 완료 처리</p>
        </div>

        <div class="api-endpoint">
            <span class="method get">GET</span>
            <code>/actions/status/{record_id}</code>
            <p>조치 진행 상황 조회</p>
        </div>
    </div>

    <div class="api-section">
        <h2>🧪 Demo 사용자</h2>
        <div class="code">
worker1 - 김작업 (생산팀A)
operator1 - 박운영 (운영팀)  
supervisor1 - 이책임 (생산팀A)
admin1 - 최관리 (IT팀)
security1 - 정보안 (보안팀)
        </div>
    </div>

    <script>
        const API_BASE = 'https://ncrceaq64l.execute-api.us-east-1.amazonaws.com/dev';
        
        async function testLogin() {
            const result = document.getElementById('login-result');
            result.textContent = '테스트 중...';
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: 'worker1', password: 'demo123' })
                });
                
                const data = await response.json();
                result.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                result.textContent = `오류: ${error.message}`;
            }
        }
        
        async function testTemplates() {
            try {
                const response = await fetch(`${API_BASE}/checklists/templates`);
                const data = await response.json();
                alert('템플릿 조회 성공! 콘솔을 확인하세요.');
                console.log('Templates:', data);
            } catch (error) {
                alert(`오류: ${error.message}`);
            }
        }
        
        async function testAI() {
            try {
                const response = await fetch(`${API_BASE}/ai/judge`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        responses: {
                            symptoms: '없음',
                            respiratory: '없음',
                            wound: '없음',
                            clothing: '적절'
                        }
                    })
                });
                
                const data = await response.json();
                alert('AI 판정 성공! 콘솔을 확인하세요.');
                console.log('AI Judgment:', data);
            } catch (error) {
                alert(`오류: ${error.message}`);
            }
        }
    </script>
</body>
</html>
