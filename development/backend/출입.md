# 출입 로그 API 사용법

## 개요
GMP CheckMaster AI의 출입 로그 관리 API입니다. 직원의 출입 기록을 저장하고 조회할 수 있습니다.

## 기본 정보
- **Base URL**: `http://localhost:3001`
- **인증**: JWT Bearer Token 필요
- **데이터 형식**: JSON

## API 엔드포인트

### 1. 출입 로그 생성
**POST** `/access-log`

직원의 출입 기록을 생성합니다.

#### 요청 헤더
```
Content-Type: application/json
Authorization: Bearer {JWT_TOKEN}
```

#### 요청 본문 (필수 필드)
```json
{
  "user_id": "EMP001",
  "user_name": "김철수",
  "action": "entry",
  "result": "success"
}
```

#### 요청 본문 (전체 필드)
```json
{
  "user_id": "EMP001",
  "user_name": "김철수", 
  "action": "entry",
  "result": "success",
  "qr_data": "eyJ1c2VyX2lkIjoiRU1QMDAxIn0=",
  "scanner_id": "SCANNER_001"
}
```

#### 필드 설명
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| `user_id` | string | ✅ | 직원 ID (예: EMP001) |
| `user_name` | string | ✅ | 직원 이름 (예: 김철수) |
| `action` | string | ✅ | 출입 동작 (`entry`: 입장, `exit`: 퇴장) |
| `result` | string | ✅ | 결과 (`success`: 성공, `failed`: 실패) |
| `qr_data` | string | ❌ | QR 코드 데이터 (Base64) |
| `scanner_id` | string | ❌ | 스캐너 ID (기본값: DEFAULT) |

#### 성공 응답 (200)
```json
{
  "success": true,
  "data": {
    "log_id": "ACCESS_20250906T054815_EMP001",
    "timestamp": "2025-09-06T05:48:15.123Z"
  }
}
```

#### 오류 응답 (400)
```json
{
  "success": false,
  "error": {
    "code": "MISSING_DATA",
    "message": "필수 데이터가 누락되었습니다 (user_id, user_name, action, result)"
  }
}
```

### 2. 출입 로그 조회
**GET** `/access-log`

출입 로그 목록을 조회합니다. **관리자만 접근 가능**합니다.

#### 요청 헤더
```
Authorization: Bearer {ADMIN_JWT_TOKEN}
```

#### 쿼리 파라미터
| 파라미터 | 타입 | 필수 | 기본값 | 설명 |
|----------|------|------|--------|------|
| `date` | string | ❌ | 오늘 날짜 | 조회할 날짜 (YYYY-MM-DD) |
| `limit` | number | ❌ | 50 | 최대 조회 개수 |

#### 요청 예시
```
GET /access-log?date=2025-09-06&limit=20
```

#### 성공 응답 (200)
```json
{
  "success": true,
  "data": {
    "date": "2025-09-06",
    "logs": [
      {
        "timestamp": "2025-09-06T05:48:15.123Z",
        "user_id": "EMP001",
        "user_name": "김철수",
        "action": "entry",
        "result": "success",
        "scanner_id": "DEFAULT",
        "log_id": "ACCESS_20250906T054815_EMP001"
      }
    ],
    "total_count": 1
  }
}
```

#### 권한 오류 (403)
```json
{
  "success": false,
  "error": {
    "code": "FORBIDDEN",
    "message": "관리자만 로그를 조회할 수 있습니다"
  }
}
```

## 사용 예시

### cURL 예시

#### 출입 로그 생성
```bash
curl -X POST "http://localhost:3001/access-log" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "user_id": "EMP001",
    "user_name": "김철수",
    "action": "entry",
    "result": "success"
  }'
```

#### 출입 로그 조회 (관리자)
```bash
curl -X GET "http://localhost:3001/access-log?date=2025-09-06" \
  -H "Authorization: Bearer ADMIN_JWT_TOKEN"
```

### JavaScript 예시

#### 출입 로그 생성
```javascript
const response = await fetch('http://localhost:3001/access-log', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${jwtToken}`
  },
  body: JSON.stringify({
    user_id: 'EMP001',
    user_name: '김철수',
    action: 'entry',
    result: 'success'
  })
});

const result = await response.json();
console.log(result.data.log_id); // ACCESS_20250906T054815_EMP001
```

#### 출입 로그 조회 (관리자)
```javascript
const response = await fetch('http://localhost:3001/access-log?date=2025-09-06', {
  headers: {
    'Authorization': `Bearer ${adminToken}`
  }
});

const result = await response.json();
console.log(result.data.logs); // 출입 로그 배열
```

## 데이터 저장 구조

### DynamoDB 테이블
- **테이블명**: `gmp-checkmaster-checklist-records`
- **Primary Key**: `record_id` (Hash), `user_id` (Range)
- **TTL**: 30일 후 자동 삭제

### 저장되는 데이터 예시
```json
{
  "record_id": "ACCESS_20250906T054815_EMP001",
  "user_id": "EMP001",
  "created_date": "2025-09-06",
  "timestamp": "2025-09-06T05:48:15.123Z",
  "user_name": "김철수",
  "action": "entry",
  "result": "success",
  "qr_data": null,
  "scanner_id": "DEFAULT",
  "log_type": "ACCESS_LOG",
  "ttl": 1757219295
}
```

## 오류 코드

| 코드 | 설명 |
|------|------|
| `MISSING_DATA` | 필수 데이터 누락 |
| `INVALID_TOKEN` | 유효하지 않은 JWT 토큰 |
| `FORBIDDEN` | 권한 없음 (관리자 전용) |
| `DATABASE_ERROR` | 데이터베이스 오류 |
| `INTERNAL_ERROR` | 서버 내부 오류 |

## 주의사항

1. **인증 필요**: 모든 API 호출 시 유효한 JWT 토큰 필요
2. **관리자 권한**: 로그 조회는 `user_type: "admin"` 토큰만 가능
3. **데이터 보존**: 출입 로그는 30일 후 자동 삭제됨
4. **필수 필드**: `user_id`, `user_name`, `action`, `result`는 반드시 포함
5. **action 값**: `entry` (입장) 또는 `exit` (퇴장)만 사용
6. **result 값**: `success` (성공) 또는 `failed` (실패)만 사용

---

**작성일**: 2025-09-06  
**버전**: 1.0  
**프로젝트**: GMP CheckMaster AI - 해커톤 프로젝트
