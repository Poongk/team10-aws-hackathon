# TASK-20250905-1858-03: API Gateway ì„¤ì • ë° ì—°ë™

## ì‘ì—… ì •ë³´
- **ì‘ì—… ID**: TASK-20250905-1858-03
- **ì œëª©**: API Gateway ì„¤ì • ë° ì—°ë™
- **ë‹´ë‹¹ì**: í’ê¸°ë•
- **í• ë‹¹ì**: ë°±ìŠ¹ì¬
- **ìš°ì„ ìˆœìœ„**: HIGH
- **ìƒíƒœ**: TODO
- **ì˜ˆìƒ ì‹œê°„**: 1.5ì‹œê°„
- **ìƒì„±ì¼**: 2025-09-05 18:58
- **ë§ˆê°ì¼**: 2025-09-06 12:00

## ì‘ì—… ëª©í‘œ
Lambda í•¨ìˆ˜ë“¤ê³¼ ì—°ë™ë˜ëŠ” API Gatewayë¥¼ Terraformìœ¼ë¡œ ì„¤ì • ë° ë°°í¬

## ìƒì„¸ ì‘ì—… ë‚´ìš©

### 1. API Gateway REST API ìƒì„±
**ì°¸ê³  ë¬¸ì„œ**: `planning/design/architecture/APIëª…ì„¸ì„œ.md`

```hcl
resource "aws_api_gateway_rest_api" "gmp_checkmaster_api" {
  name        = "gmp-checkmaster-api"
  description = "GMP CheckMaster AI API Gateway"
  
  endpoint_configuration {
    types = ["REGIONAL"]
  }
}
```

### 2. API Gateway ë¦¬ì†ŒìŠ¤ ë° ë©”ì„œë“œ ì„¤ì •

#### ğŸ” **ì¸ì¦ API (/auth)**
```hcl
# /auth ë¦¬ì†ŒìŠ¤
resource "aws_api_gateway_resource" "auth" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  path_part   = "auth"
}

# POST /auth/login
resource "aws_api_gateway_method" "auth_login" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_resource.auth.id
  http_method   = "POST"
  authorization = "NONE"
}

resource "aws_api_gateway_integration" "auth_login" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_resource.auth.id
  http_method = aws_api_gateway_method.auth_login.http_method
  
  integration_http_method = "POST"
  type                   = "AWS_PROXY"
  uri                    = aws_lambda_function.auth_handler.invoke_arn
}
```

#### ğŸ“‹ **ì²´í¬ë¦¬ìŠ¤íŠ¸ API (/checklists)**
```hcl
# /checklists ë¦¬ì†ŒìŠ¤
resource "aws_api_gateway_resource" "checklists" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  path_part   = "checklists"
}

# GET /checklists/templates
resource "aws_api_gateway_resource" "checklist_templates" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_resource.checklists.id
  path_part   = "templates"
}

resource "aws_api_gateway_method" "get_templates" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_resource.checklist_templates.id
  http_method   = "GET"
  authorization = "NONE"  # í•´ì»¤í†¤ìš© ê°„ì†Œí™”
}

resource "aws_api_gateway_integration" "get_templates" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_resource.checklist_templates.id
  http_method = aws_api_gateway_method.get_templates.http_method
  
  integration_http_method = "POST"
  type                   = "AWS_PROXY"
  uri                    = aws_lambda_function.checklist_handler.invoke_arn
}

# POST /checklists/submit
resource "aws_api_gateway_resource" "checklist_submit" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_resource.checklists.id
  path_part   = "submit"
}

resource "aws_api_gateway_method" "submit_checklist" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_resource.checklist_submit.id
  http_method   = "POST"
  authorization = "NONE"  # í•´ì»¤í†¤ìš© ê°„ì†Œí™”
}

resource "aws_api_gateway_integration" "submit_checklist" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_resource.checklist_submit.id
  http_method = aws_api_gateway_method.submit_checklist.http_method
  
  integration_http_method = "POST"
  type                   = "AWS_PROXY"
  uri                    = aws_lambda_function.checklist_handler.invoke_arn
}
```

#### ğŸ¤– **AI íŒì • API (/ai)**
```hcl
# /ai ë¦¬ì†ŒìŠ¤
resource "aws_api_gateway_resource" "ai" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  path_part   = "ai"
}

# POST /ai/judge
resource "aws_api_gateway_resource" "ai_judge" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_resource.ai.id
  path_part   = "judge"
}

resource "aws_api_gateway_method" "ai_judge" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_resource.ai_judge.id
  http_method   = "POST"
  authorization = "NONE"
}

resource "aws_api_gateway_integration" "ai_judge" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_resource.ai_judge.id
  http_method = aws_api_gateway_method.ai_judge.http_method
  
  integration_http_method = "POST"
  type                   = "AWS_PROXY"
  uri                    = aws_lambda_function.ai_judgment_handler.invoke_arn
}
```

#### ğŸ“± **QR ì½”ë“œ API (/qr)**
```hcl
# /qr ë¦¬ì†ŒìŠ¤
resource "aws_api_gateway_resource" "qr" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  path_part   = "qr"
}

# POST /qr/generate
resource "aws_api_gateway_resource" "qr_generate" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  parent_id   = aws_api_gateway_resource.qr.id
  path_part   = "generate"
}

resource "aws_api_gateway_method" "qr_generate" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_resource.qr_generate.id
  http_method   = "POST"
  authorization = "NONE"
}

resource "aws_api_gateway_integration" "qr_generate" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_resource.qr_generate.id
  http_method = aws_api_gateway_method.qr_generate.http_method
  
  integration_http_method = "POST"
  type                   = "AWS_PROXY"
  uri                    = aws_lambda_function.qr_handler.invoke_arn
}
```

### 3. CORS ì„¤ì •
```hcl
resource "aws_api_gateway_method" "options_cors" {
  rest_api_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id   = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  http_method   = "OPTIONS"
  authorization = "NONE"
}

resource "aws_api_gateway_integration" "options_cors" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  http_method = aws_api_gateway_method.options_cors.http_method
  type        = "MOCK"
  
  request_templates = {
    "application/json" = "{\"statusCode\": 200}"
  }
}

resource "aws_api_gateway_method_response" "options_cors" {
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  resource_id = aws_api_gateway_rest_api.gmp_checkmaster_api.root_resource_id
  http_method = aws_api_gateway_method.options_cors.http_method
  status_code = "200"
  
  response_parameters = {
    "method.response.header.Access-Control-Allow-Headers" = true
    "method.response.header.Access-Control-Allow-Methods" = true
    "method.response.header.Access-Control-Allow-Origin"  = true
  }
}
```

### 4. API Gateway ë°°í¬
```hcl
resource "aws_api_gateway_deployment" "gmp_checkmaster_deployment" {
  depends_on = [
    aws_api_gateway_integration.auth_login,
    aws_api_gateway_integration.get_templates,
    aws_api_gateway_integration.submit_checklist,
    aws_api_gateway_integration.ai_judge,
    aws_api_gateway_integration.qr_generate
  ]
  
  rest_api_id = aws_api_gateway_rest_api.gmp_checkmaster_api.id
  stage_name  = "dev"
}
```

### 5. Lambda ê¶Œí•œ ì„¤ì •
```hcl
resource "aws_lambda_permission" "api_gateway_auth" {
  statement_id  = "AllowExecutionFromAPIGateway"
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.auth_handler.function_name
  principal     = "apigateway.amazonaws.com"
  source_arn    = "${aws_api_gateway_rest_api.gmp_checkmaster_api.execution_arn}/*/*"
}

# ë‹¤ë¥¸ Lambda í•¨ìˆ˜ë“¤ë„ ë™ì¼í•˜ê²Œ ì„¤ì •...
```

## ìˆ˜ìš© ê¸°ì¤€
- [ ] API Gateway REST API ìƒì„± ì™„ë£Œ
- [ ] ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸ 5ê°œ ì„¤ì • ì™„ë£Œ (/auth, /checklists, /ai, /qr, /dashboard)
- [ ] Lambda í•¨ìˆ˜ ì—°ë™ ì™„ë£Œ
- [ ] CORS ì„¤ì • ì™„ë£Œ
- [ ] API Gateway ë°°í¬ ì™„ë£Œ (dev ìŠ¤í…Œì´ì§€)
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ (ê¸°ë³¸ ì‘ë‹µ í™•ì¸)

## ì°¸ê³  ìë£Œ
- `planning/design/architecture/APIëª…ì„¸ì„œ.md`
- `planning/design/architecture/ì‹œìŠ¤í…œì•„í‚¤í…ì²˜.md`

## ì˜ì¡´ì„±
- **ì„ í–‰ ì‘ì—…**: TASK-20250905-1858-02 (Lambda í•¨ìˆ˜ ë°°í¬)
- **í›„ì† ì‘ì—…**: í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ (TASK-20250905-1858-04)

## ìœ„í—˜ ìš”ì†Œ
- API Gateway ì„¤ì • ë³µì¡ì„±
- Lambda ê¶Œí•œ ì„¤ì • ì˜¤ë¥˜
- CORS ì„¤ì • ëˆ„ë½

---
**ìƒì„±ì¼**: 2025-09-05 18:58  
**ë‹´ë‹¹ì**: í’ê¸°ë•  
**ìƒíƒœ**: TODO
