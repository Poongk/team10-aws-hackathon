# TASK-20250905-1913: ë°±ì—”ë“œ ê¸°ë³¸ êµ¬ì¡° ë° Lambda í•¨ìˆ˜ ê°œë°œ

## ì‘ì—… ì •ë³´
- **ì‘ì—… ID**: TASK-20250905-1913
- **ì œëª©**: ë°±ì—”ë“œ ê¸°ë³¸ êµ¬ì¡° ë° Lambda í•¨ìˆ˜ ê°œë°œ
- **ë‹´ë‹¹ì**: ë°±ìŠ¹ì¬
- **í• ë‹¹ì**: ë°±ìŠ¹ì¬
- **ìš°ì„ ìˆœìœ„**: HIGH
- **ìƒíƒœ**: TODO
- **ì˜ˆìƒ ì‹œê°„**: 3ì‹œê°„
- **ìƒì„±ì¼**: 2025-09-05 19:13
- **ë§ˆê°ì¼**: 2025-09-06 09:00

## ì‘ì—… ëª©í‘œ
SAM í…œí”Œë¦¿ ê¸°ë°˜ Lambda í•¨ìˆ˜ 5ê°œ ê¸°ë³¸ êµ¬ì¡° ìƒì„± ë° í•µì‹¬ API êµ¬í˜„

## ìƒì„¸ ì‘ì—… ë‚´ìš©

### 1. í”„ë¡œì íŠ¸ êµ¬ì¡° ìƒì„±
```
development/backend/
â”œâ”€â”€ template.yaml              # SAM í…œí”Œë¦¿
â”œâ”€â”€ lambda/
â”‚   â”œâ”€â”€ auth-handler/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ checklist-handler/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ ai-judgment-handler/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ qr-handler/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ dashboard-handler/
â”‚       â”œâ”€â”€ index.js
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ response-utils.js      # ê³µí†µ ì‘ë‹µ ìœ í‹¸
â”‚   â”œâ”€â”€ auth-utils.js          # ì¸ì¦ ìœ í‹¸
â”‚   â””â”€â”€ mock-data.js           # í•´ì»¤í†¤ìš© Mock ë°ì´í„°
â”œâ”€â”€ events/                    # í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸
â”‚   â”œâ”€â”€ login.json
â”‚   â”œâ”€â”€ get-templates.json
â”‚   â”œâ”€â”€ submit-checklist.json
â”‚   â”œâ”€â”€ ai-judge.json
â”‚   â””â”€â”€ generate-qr.json
â””â”€â”€ scripts/
    â””â”€â”€ dev-start.sh           # ë¡œì»¬ ê°œë°œ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
```

### 2. SAM í…œí”Œë¦¿ ì‘ì„±
```yaml
# template.yaml
AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    Runtime: nodejs18.x
    Timeout: 30
    MemorySize: 256
    Environment:
      Variables:
        NODE_ENV: development
        CORS_ORIGIN: "*"

Resources:
  # ì¸ì¦ í•¸ë“¤ëŸ¬
  AuthHandler:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambda/auth-handler/
      Handler: index.handler
      Events:
        LoginApi:
          Type: Api
          Properties:
            Path: /auth/login
            Method: post
        LogoutApi:
          Type: Api
          Properties:
            Path: /auth/logout
            Method: post

  # ì²´í¬ë¦¬ìŠ¤íŠ¸ í•¸ë“¤ëŸ¬
  ChecklistHandler:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambda/checklist-handler/
      Handler: index.handler
      Events:
        GetTemplates:
          Type: Api
          Properties:
            Path: /checklists/templates
            Method: get
        SubmitChecklist:
          Type: Api
          Properties:
            Path: /checklists/submit
            Method: post
        GetRecords:
          Type: Api
          Properties:
            Path: /checklists/records
            Method: get

  # AI íŒì • í•¸ë“¤ëŸ¬
  AIJudgmentHandler:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambda/ai-judgment-handler/
      Handler: index.handler
      MemorySize: 512
      Events:
        JudgeApi:
          Type: Api
          Properties:
            Path: /ai/judge
            Method: post

  # QR ì½”ë“œ í•¸ë“¤ëŸ¬
  QRHandler:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambda/qr-handler/
      Handler: index.handler
      Events:
        GenerateQR:
          Type: Api
          Properties:
            Path: /qr/generate
            Method: post
        VerifyQR:
          Type: Api
          Properties:
            Path: /qr/verify
            Method: post

  # ëŒ€ì‹œë³´ë“œ í•¸ë“¤ëŸ¬
  DashboardHandler:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: lambda/dashboard-handler/
      Handler: index.handler
      Events:
        GetStats:
          Type: Api
          Properties:
            Path: /dashboard/stats
            Method: get
        GetReports:
          Type: Api
          Properties:
            Path: /dashboard/reports
            Method: get

Outputs:
  ApiGatewayEndpoint:
    Description: "API Gateway endpoint URL"
    Value: !Sub "https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/"
```

### 3. ê³µí†µ ìœ í‹¸ë¦¬í‹° ì‘ì„±

#### shared/response-utils.js
```javascript
// í‘œì¤€ ì‘ë‹µ í˜•ì‹
const createResponse = (statusCode, data, message = null) => {
  return {
    statusCode,
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type, Authorization',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      success: statusCode < 400,
      data,
      message,
      timestamp: new Date().toISOString()
    })
  };
};

const successResponse = (data, message = 'Success') => createResponse(200, data, message);
const errorResponse = (statusCode, message, data = null) => createResponse(statusCode, data, message);

module.exports = { createResponse, successResponse, errorResponse };
```

#### shared/mock-data.js
```javascript
// í•´ì»¤í†¤ìš© Mock ë°ì´í„°
const DEMO_USERS = {
  'worker1': { id: 'worker1', name: 'ê¹€ì‘ì—…', role: 'worker', team: 'ìƒì‚°íŒ€A' },
  'operator1': { id: 'operator1', name: 'ë°•ìš´ì˜', role: 'operator', team: 'ìš´ì˜íŒ€' },
  'supervisor1': { id: 'supervisor1', name: 'ì´ì±…ì„', role: 'supervisor', team: 'ìƒì‚°íŒ€A' },
  'admin1': { id: 'admin1', name: 'ìµœê´€ë¦¬', role: 'admin', team: 'ITíŒ€' },
  'security1': { id: 'security1', name: 'ì •ë³´ì•ˆ', role: 'security', team: 'ë³´ì•ˆíŒ€' }
};

const HYGIENE_TEMPLATE = {
  template_id: 'hygiene_checklist',
  name: 'ìœ„ìƒìƒíƒœì ê²€í‘œ',
  type: 'hygiene',
  items: [
    { id: 'symptoms', question: 'ë°œì—´, ì„¤ì‚¬, êµ¬í†  ì¦ìƒì´ ìˆë‚˜ìš”?', type: 'select', options: ['ì—†ìŒ', 'ìˆìŒ'] },
    { id: 'respiratory', question: 'í˜¸í¡ê¸° ì§ˆí™˜ì€ ì—†ë‚˜ìš”?', type: 'select', options: ['ì—†ìŒ', 'ìˆìŒ'] },
    { id: 'wound', question: 'ì‹ ì²´ì— ìƒì²˜ê°€ ìˆë‚˜ìš”?', type: 'select', options: ['ì—†ìŒ', 'ìˆìŒ'] },
    { id: 'clothing', question: 'ì‘ì—…ë³µ ì°©ìš©ì´ ì ì ˆí•œê°€ìš”?', type: 'select', options: ['ì ì ˆ', 'ë¶€ì ì ˆ'] },
    { id: 'accessories', question: 'ì¥ì‹ êµ¬ë¥¼ ì œê±°í–ˆë‚˜ìš”?', type: 'select', options: ['ì œê±°í•¨', 'ì°©ìš©ì¤‘'] },
    { id: 'hair', question: 'ë‘ë°œ ìƒíƒœê°€ ì ì ˆí•œê°€ìš”?', type: 'select', options: ['ì ì ˆ', 'ë¶€ì ì ˆ'] },
    { id: 'nails', question: 'ì†í†±ì´ ê¹¨ë—í•˜ê³  ì§§ì€ê°€ìš”?', type: 'select', options: ['ì ì ˆ', 'ë¶€ì ì ˆ'] },
    { id: 'makeup', question: 'í™”ì¥ì„ í•˜ì§€ ì•Šì•˜ë‚˜ìš”?', type: 'select', options: ['ì•ˆí•¨', 'í•¨'] },
    { id: 'personal_items', question: 'ê°œì¸ ë¬¼í’ˆì„ ë°˜ì…í•˜ì§€ ì•Šì•˜ë‚˜ìš”?', type: 'select', options: ['ë°˜ì…ì•ˆí•¨', 'ë°˜ì…í•¨'] }
  ]
};

module.exports = { DEMO_USERS, HYGIENE_TEMPLATE };
```

### 4. Lambda í•¨ìˆ˜ êµ¬í˜„

#### lambda/auth-handler/index.js
```javascript
const { successResponse, errorResponse } = require('../../shared/response-utils');
const { DEMO_USERS } = require('../../shared/mock-data');

exports.handler = async (event) => {
  try {
    console.log('Auth Event:', JSON.stringify(event, null, 2));
    
    const path = event.path;
    const method = event.httpMethod;
    
    if (path === '/auth/login' && method === 'POST') {
      return await handleLogin(event);
    }
    
    if (path === '/auth/logout' && method === 'POST') {
      return await handleLogout(event);
    }
    
    return errorResponse(404, 'Not Found');
    
  } catch (error) {
    console.error('Auth Error:', error);
    return errorResponse(500, 'Internal Server Error');
  }
};

async function handleLogin(event) {
  const { user_id, password } = JSON.parse(event.body);
  
  if (DEMO_USERS[user_id]) {
    return successResponse({
      token: `demo-jwt-${user_id}-${Date.now()}`,
      user: DEMO_USERS[user_id]
    }, 'Login successful');
  }
  
  return errorResponse(401, 'Invalid credentials');
}

async function handleLogout(event) {
  return successResponse(null, 'Logout successful');
}
```

#### lambda/checklist-handler/index.js
```javascript
const { successResponse, errorResponse } = require('../../shared/response-utils');
const { HYGIENE_TEMPLATE } = require('../../shared/mock-data');

exports.handler = async (event) => {
  try {
    console.log('Checklist Event:', JSON.stringify(event, null, 2));
    
    const path = event.path;
    const method = event.httpMethod;
    
    if (path === '/checklists/templates' && method === 'GET') {
      return await getTemplates(event);
    }
    
    if (path === '/checklists/submit' && method === 'POST') {
      return await submitChecklist(event);
    }
    
    if (path === '/checklists/records' && method === 'GET') {
      return await getRecords(event);
    }
    
    return errorResponse(404, 'Not Found');
    
  } catch (error) {
    console.error('Checklist Error:', error);
    return errorResponse(500, 'Internal Server Error');
  }
};

async function getTemplates(event) {
  return successResponse([HYGIENE_TEMPLATE], 'Templates retrieved');
}

async function submitChecklist(event) {
  const data = JSON.parse(event.body);
  
  // Mock ì €ì¥ (ì‹¤ì œë¡œëŠ” DynamoDBì— ì €ì¥)
  const record = {
    record_id: `record_${Date.now()}`,
    user_id: data.user_id,
    template_id: data.template_id,
    responses: data.responses,
    submitted_at: new Date().toISOString(),
    status: 'pending'
  };
  
  return successResponse(record, 'Checklist submitted');
}

async function getRecords(event) {
  // Mock ë°ì´í„° ë°˜í™˜
  const records = [
    {
      record_id: 'record_1',
      user_id: 'worker1',
      template_id: 'hygiene_checklist',
      status: 'approved',
      submitted_at: '2025-09-05T10:00:00Z'
    }
  ];
  
  return successResponse(records, 'Records retrieved');
}
```

#### lambda/ai-judgment-handler/index.js
```javascript
const { successResponse, errorResponse } = require('../../shared/response-utils');

exports.handler = async (event) => {
  try {
    console.log('AI Judgment Event:', JSON.stringify(event, null, 2));
    
    const { responses } = JSON.parse(event.body);
    
    // ê·œì¹™ ê¸°ë°˜ ê°„ë‹¨ íŒì • ë¡œì§
    const judgment = judgeHealthStatus(responses);
    
    return successResponse(judgment, 'AI judgment completed');
    
  } catch (error) {
    console.error('AI Judgment Error:', error);
    return errorResponse(500, 'Internal Server Error');
  }
};

function judgeHealthStatus(responses) {
  // 1. ë°œì—´/ì„¤ì‚¬/êµ¬í†  ì¦ìƒ ìˆìŒ â†’ ìë™ ê±°ë¶€
  if (responses.symptoms === 'ìˆìŒ') {
    return {
      result: 'rejected',
      reason: 'ë°œì—´/ì„¤ì‚¬/êµ¬í†  ì¦ìƒìœ¼ë¡œ ì¶œì… ë¶ˆê°€',
      confidence: 1.0,
      qr_eligible: false
    };
  }
  
  // 2. í˜¸í¡ê¸° ì¦ìƒ ìˆìŒ â†’ ì¬í™•ì¸ í•„ìš”
  if (responses.respiratory === 'ìˆìŒ') {
    return {
      result: 'recheck',
      reason: 'í˜¸í¡ê¸° ì¦ìƒìœ¼ë¡œ ì¬í™•ì¸ í•„ìš”',
      confidence: 0.8,
      qr_eligible: false
    };
  }
  
  // 3. ë³µì¥/ìƒì²˜ ë¶€ì ì ˆ â†’ ì¬í™•ì¸ í•„ìš”
  if (responses.clothing === 'ë¶€ì ì ˆ' || responses.wound === 'ìˆìŒ') {
    return {
      result: 'recheck',
      reason: 'ë³µì¥ ë˜ëŠ” ìƒì²˜ë¡œ ì¬í™•ì¸ í•„ìš”',
      confidence: 0.7,
      qr_eligible: false
    };
  }
  
  // 4. ëª¨ë“  í•­ëª© ì •ìƒ â†’ ì¶œì… ê°€ëŠ¥
  return {
    result: 'approved',
    reason: 'ëª¨ë“  í•­ëª©ì´ ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤',
    confidence: 0.95,
    qr_eligible: true
  };
}
```

### 5. í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ì‘ì„±

#### events/login.json
```json
{
  "httpMethod": "POST",
  "path": "/auth/login",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": "{\"user_id\":\"worker1\",\"password\":\"demo123\"}"
}
```

#### events/submit-checklist.json
```json
{
  "httpMethod": "POST",
  "path": "/checklists/submit",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": "{\"user_id\":\"worker1\",\"template_id\":\"hygiene_checklist\",\"responses\":{\"symptoms\":\"ì—†ìŒ\",\"respiratory\":\"ì—†ìŒ\",\"wound\":\"ì—†ìŒ\",\"clothing\":\"ì ì ˆ\"}}"
}
```

### 6. ë¡œì»¬ ê°œë°œ ìŠ¤í¬ë¦½íŠ¸

#### scripts/dev-start.sh
```bash
#!/bin/bash
echo "ğŸš€ ë°±ì—”ë“œ ë¡œì»¬ ê°œë°œ í™˜ê²½ ì‹œì‘..."

cd "$(dirname "$0")/.."

# ì˜ì¡´ì„± ì„¤ì¹˜
echo "ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
for dir in lambda/*/; do
  if [ -f "$dir/package.json" ]; then
    echo "Installing dependencies for $dir"
    (cd "$dir" && npm install)
  fi
done

# SAM Local API ì‹œì‘
echo "ğŸŒ SAM Local API ì‹œì‘ (í¬íŠ¸ 3001)..."
sam local start-api --port 3001

echo "âœ… ë¡œì»¬ í™˜ê²½ ì¤€ë¹„ ì™„ë£Œ!"
echo "ğŸŒ API: http://localhost:3001"
```

## ìˆ˜ìš© ê¸°ì¤€
- [ ] SAM í…œí”Œë¦¿ ì‘ì„± ì™„ë£Œ
- [ ] Lambda í•¨ìˆ˜ 5ê°œ ê¸°ë³¸ êµ¬ì¡° ìƒì„±
- [ ] ê³µí†µ ìœ í‹¸ë¦¬í‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‘ì„±
- [ ] Mock ë°ì´í„° ê¸°ë°˜ í•µì‹¬ API êµ¬í˜„
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶• (SAM Local)
- [ ] í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ì‘ì„± ë° ê²€ì¦
- [ ] API ì‘ë‹µ í˜•ì‹ í‘œì¤€í™”
- [ ] CORS ì„¤ì • ì™„ë£Œ

## ì°¸ê³  ìë£Œ
- `development/setup/Lambdaë¡œì»¬ê°œë°œê°€ì´ë“œ.md`
- `planning/design/architecture/APIëª…ì„¸ì„œ.md`
- `planning/design/architecture/ì‹œìŠ¤í…œì•„í‚¤í…ì²˜.md`
- `planning/design/architecture/ë°ì´í„°ë² ì´ìŠ¤ìŠ¤í‚¤ë§ˆ.md`

## ì˜ì¡´ì„±
- **ì„ í–‰ ì‘ì—…**: TASK-20250905-1752 (ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„) ì™„ë£Œ
- **ë³‘ë ¬ ì‘ì—…**: TASK-20250905-1858-01~04 (ì¸í”„ë¼ êµ¬ì¶•)
- **í›„ì† ì‘ì—…**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ë° í†µí•©

## ìœ„í—˜ ìš”ì†Œ
- SAM Local ì„¤ì • ë³µì¡ì„±
- Lambda í•¨ìˆ˜ ê°„ ì˜ì¡´ì„± ê´€ë¦¬
- Mock ë°ì´í„°ì™€ ì‹¤ì œ ë°ì´í„° ê°„ ì°¨ì´

## í•´ì»¤í†¤ ìµœì í™”
- DynamoDB ëŒ€ì‹  ë©”ëª¨ë¦¬ ê¸°ë°˜ Mock ë°ì´í„° ì‚¬ìš©
- ë³µì¡í•œ ì¸ì¦ ëŒ€ì‹  ê°„ë‹¨í•œ í† í° ë°©ì‹
- ì—ëŸ¬ ì²˜ë¦¬ ê°„ì†Œí™”
- ë¡œê·¸ ì¶œë ¥ ìµœëŒ€í™” (ë””ë²„ê¹… í¸ì˜)

---
**ìƒì„±ì¼**: 2025-09-05 19:13  
**ë‹´ë‹¹ì**: ë°±ìŠ¹ì¬  
**ìƒíƒœ**: TODO  
**ì˜ˆìƒ ì™„ë£Œ**: 2025-09-06 09:00
