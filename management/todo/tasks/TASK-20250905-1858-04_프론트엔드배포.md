# TASK-20250905-1858-04: S3 + CloudFront í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬

## ì‘ì—… ì •ë³´
- **ì‘ì—… ID**: TASK-20250905-1858-04
- **ì œëª©**: S3 + CloudFront í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬
- **ë‹´ë‹¹ì**: í’ê¸°ë•
- **í• ë‹¹ì**: ë°±ìŠ¹ì¬
- **ìš°ì„ ìˆœìœ„**: MEDIUM
- **ìƒíƒœ**: TODO
- **ì˜ˆìƒ ì‹œê°„**: 2ì‹œê°„
- **ìƒì„±ì¼**: 2025-09-05 18:58
- **ë§ˆê°ì¼**: 2025-09-06 14:00

## ì‘ì—… ëª©í‘œ
React ì•±ì„ S3ì— ë°°í¬í•˜ê³  CloudFrontë¡œ CDN ì„¤ì •í•˜ëŠ” Terraform ì¸í”„ë¼ êµ¬ì¶•

## ìƒì„¸ ì‘ì—… ë‚´ìš©

### 1. S3 ë²„í‚· ìƒì„± ë° ì„¤ì •
```hcl
resource "aws_s3_bucket" "frontend" {
  bucket = "gmp-checkmaster-frontend-${var.environment}"
}

resource "aws_s3_bucket_website_configuration" "frontend" {
  bucket = aws_s3_bucket.frontend.id
  
  index_document {
    suffix = "index.html"
  }
  
  error_document {
    key = "error.html"
  }
}

resource "aws_s3_bucket_versioning" "frontend" {
  bucket = aws_s3_bucket.frontend.id
  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "frontend" {
  bucket = aws_s3_bucket.frontend.id
  
  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm = "AES256"
    }
  }
}
```

### 2. S3 ë²„í‚· ì •ì±… ì„¤ì •
```hcl
resource "aws_s3_bucket_policy" "frontend" {
  bucket = aws_s3_bucket.frontend.id
  
  policy = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Sid       = "PublicReadGetObject"
        Effect    = "Allow"
        Principal = "*"
        Action    = "s3:GetObject"
        Resource  = "${aws_s3_bucket.frontend.arn}/*"
        Condition = {
          StringEquals = {
            "AWS:SourceArn" = aws_cloudfront_distribution.frontend.arn
          }
        }
      }
    ]
  })
}

resource "aws_s3_bucket_public_access_block" "frontend" {
  bucket = aws_s3_bucket.frontend.id
  
  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}
```

### 3. CloudFront ë°°í¬ ì„¤ì •
```hcl
resource "aws_cloudfront_origin_access_control" "frontend" {
  name                              = "gmp-checkmaster-frontend-oac"
  description                       = "OAC for GMP CheckMaster frontend"
  origin_access_control_origin_type = "s3"
  signing_behavior                  = "always"
  signing_protocol                  = "sigv4"
}

resource "aws_cloudfront_distribution" "frontend" {
  origin {
    domain_name              = aws_s3_bucket.frontend.bucket_regional_domain_name
    origin_access_control_id = aws_cloudfront_origin_access_control.frontend.id
    origin_id                = "S3-${aws_s3_bucket.frontend.bucket}"
  }
  
  enabled             = true
  is_ipv6_enabled     = true
  default_root_object = "index.html"
  
  default_cache_behavior {
    allowed_methods        = ["DELETE", "GET", "HEAD", "OPTIONS", "PATCH", "POST", "PUT"]
    cached_methods         = ["GET", "HEAD"]
    target_origin_id       = "S3-${aws_s3_bucket.frontend.bucket}"
    compress               = true
    viewer_protocol_policy = "redirect-to-https"
    
    forwarded_values {
      query_string = false
      cookies {
        forward = "none"
      }
    }
    
    min_ttl     = 0
    default_ttl = 3600
    max_ttl     = 86400
  }
  
  # SPAë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ ì—ëŸ¬ í˜ì´ì§€ ì„¤ì •
  custom_error_response {
    error_code         = 404
    response_code      = 200
    response_page_path = "/index.html"
  }
  
  custom_error_response {
    error_code         = 403
    response_code      = 200
    response_page_path = "/index.html"
  }
  
  restrictions {
    geo_restriction {
      restriction_type = "none"
    }
  }
  
  viewer_certificate {
    cloudfront_default_certificate = true
  }
  
  tags = {
    Name        = "gmp-checkmaster-frontend"
    Environment = var.environment
  }
}
```

### 4. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
```bash
#!/bin/bash
# development/scripts/deploy-frontend.sh

set -e

echo "ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ì‹œì‘..."

# React ì•± ë¹Œë“œ
echo "ğŸ“¦ React ì•± ë¹Œë“œ ì¤‘..."
cd development/frontend
npm run build

# S3ì— ì—…ë¡œë“œ
echo "â˜ï¸ S3ì— ì—…ë¡œë“œ ì¤‘..."
aws s3 sync build/ s3://gmp-checkmaster-frontend-dev --delete

# CloudFront ìºì‹œ ë¬´íš¨í™”
echo "ğŸ”„ CloudFront ìºì‹œ ë¬´íš¨í™” ì¤‘..."
DISTRIBUTION_ID=$(aws cloudfront list-distributions --query "DistributionList.Items[?Comment=='GMP CheckMaster Frontend'].Id" --output text)
aws cloudfront create-invalidation --distribution-id $DISTRIBUTION_ID --paths "/*"

echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ ì™„ë£Œ!"
echo "ğŸŒ URL: https://$DISTRIBUTION_ID.cloudfront.net"
```

### 5. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```hcl
# React ì•±ìš© í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±
resource "local_file" "frontend_env" {
  content = templatefile("${path.module}/templates/.env.template", {
    api_base_url = aws_api_gateway_deployment.gmp_checkmaster_deployment.invoke_url
    aws_region   = var.aws_region
    environment  = var.environment
  })
  filename = "${path.module}/../../frontend/.env.production"
}
```

```bash
# templates/.env.template
REACT_APP_API_BASE_URL=${api_base_url}
REACT_APP_AWS_REGION=${aws_region}
REACT_APP_ENVIRONMENT=${environment}
GENERATE_SOURCEMAP=false
```

### 6. ì¶œë ¥ ê°’ ì„¤ì •
```hcl
# outputs.tf
output "frontend_s3_bucket" {
  description = "S3 bucket name for frontend"
  value       = aws_s3_bucket.frontend.bucket
}

output "frontend_cloudfront_url" {
  description = "CloudFront distribution URL"
  value       = "https://${aws_cloudfront_distribution.frontend.domain_name}"
}

output "frontend_cloudfront_distribution_id" {
  description = "CloudFront distribution ID"
  value       = aws_cloudfront_distribution.frontend.id
}
```

### 7. ë¹Œë“œ ë° ë°°í¬ ìë™í™”
```hcl
# ë¡œì»¬ì—ì„œ React ì•± ë¹Œë“œ í›„ S3 ì—…ë¡œë“œ
resource "null_resource" "build_and_deploy_frontend" {
  depends_on = [
    aws_s3_bucket.frontend,
    aws_cloudfront_distribution.frontend,
    local_file.frontend_env
  ]
  
  provisioner "local-exec" {
    command = <<-EOT
      cd ${path.module}/../../frontend
      npm install
      npm run build
      aws s3 sync build/ s3://${aws_s3_bucket.frontend.bucket} --delete
    EOT
  }
  
  triggers = {
    always_run = timestamp()
  }
}
```

## ìˆ˜ìš© ê¸°ì¤€
- [ ] S3 ë²„í‚· ìƒì„± ë° ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… ì„¤ì • ì™„ë£Œ
- [ ] CloudFront ë°°í¬ ìƒì„± ì™„ë£Œ
- [ ] OAC(Origin Access Control) ì„¤ì • ì™„ë£Œ
- [ ] SPA ë¼ìš°íŒ…ì„ ìœ„í•œ ì»¤ìŠ¤í…€ ì—ëŸ¬ í˜ì´ì§€ ì„¤ì •
- [ ] React ì•± ë¹Œë“œ ë° S3 ì—…ë¡œë“œ ì™„ë£Œ
- [ ] CloudFront URLë¡œ ì ‘ì† í™•ì¸
- [ ] ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° í…ŒìŠ¤íŠ¸

## ì°¸ê³  ìë£Œ
- `development/setup/ê°œë°œí™˜ê²½ê°€ì´ë“œ.md`
- AWS S3 ì •ì  ì›¹ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ… ë¬¸ì„œ
- AWS CloudFront ë¬¸ì„œ

## ì˜ì¡´ì„±
- **ì„ í–‰ ì‘ì—…**: TASK-20250905-1858-03 (API Gateway ì„¤ì •)
- **í›„ì† ì‘ì—…**: ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸

## ìœ„í—˜ ìš”ì†Œ
- CloudFront ë°°í¬ ì‹œê°„ (15-20ë¶„ ì†Œìš”)
- S3 ë²„í‚· ì •ì±… ì„¤ì • ì˜¤ë¥˜
- React ì•± ë¹Œë“œ ì‹¤íŒ¨
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ëˆ„ë½

## í•´ì»¤í†¤ ìµœì í™”
- CloudFront ëŒ€ì‹  S3 ì •ì  ì›¹ì‚¬ì´íŠ¸ë§Œ ì‚¬ìš© ê³ ë ¤ (ì‹œê°„ ë‹¨ì¶•)
- ìºì‹œ ì„¤ì • ìµœì†Œí™”ë¡œ ê°œë°œ í¸ì˜ì„± í–¥ìƒ
- ê°„ë‹¨í•œ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¹ ë¥¸ ì—…ë°ì´íŠ¸

---
**ìƒì„±ì¼**: 2025-09-05 18:58  
**ë‹´ë‹¹ì**: í’ê¸°ë•  
**ìƒíƒœ**: TODO
