# GMP CheckMaster AI - 시스템 아키텍처

## 개요
- **프로젝트**: GMP CheckMaster AI
- **아키텍처**: AWS 서버리스 마이크로서비스
- **설계 기준**: MVP 요구사항 v2.0
- **작성일**: 2025-09-05

## 전체 시스템 구조

### 고수준 아키텍처
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   사용자 단말    │    │   AWS 클라우드    │    │   외부 서비스    │
│                │    │                 │    │                │
│ 작업자 모바일    │◄──►│  API Gateway     │    │ Amazon Q        │
│ 운영자 웹       │    │       │         │    │ Developer       │
│ 책임자 모바일    │    │       ▼         │    │                │
│ 관리자 웹       │    │  Lambda 함수들   │◄──►│                │
│ 보안담당 모바일  │    │       │         │    │                │
│ (QR 스캐너)     │    │       ▼         │    └─────────────────┘
└─────────────────┘    │   DynamoDB      │
                      │                 │
                      └──────────────────┘
```

### 상세 컴포넌트 구조
```
Frontend (React)
├── 작업자 앱 (모바일 최적화)
│   ├── 체크리스트 입력 화면
│   ├── AI 판정 결과 화면
│   ├── QR 코드 표시 화면
│   └── 개인 이력 화면
├── 운영자 대시보드 (웹)
│   ├── 실시간 현황 모니터링
│   ├── 배정 관리 화면
│   ├── 스케줄 관리 화면
│   └── 알림 관리 화면
├── 책임자 앱 (모바일)
│   ├── 팀 현황 화면
│   └── 알림 수신 화면
├── 관리자 대시보드 (웹)
│   ├── 템플릿 관리 화면
│   ├── AI 규칙 설정 화면
│   ├── 사용자 관리 화면
│   └── 시스템 설정 화면
└── 보안담당자 앱 (모바일) - 해커톤 시연용
    ├── QR 스캐너 화면 (카메라 사용)
    └── 출입 결과 표시 화면

API Gateway
├── /auth/*           # 인증/권한
├── /checklist/*      # 체크리스트 CRUD
├── /ai/*            # AI 판정
├── /assignment/*     # 배정 관리
├── /dashboard/*      # 현황 조회
├── /qr/*            # QR 코드
└── /notification/*   # 알림

Lambda Functions
├── auth-handler      # 인증/권한 관리
├── checklist-handler # 체크리스트 CRUD
├── ai-judgment-handler # AI 판정 처리
├── assignment-handler # 배정 관리
├── dashboard-handler # 현황 집계
├── qr-handler       # QR 코드 생성/검증
└── notification-handler # 알림 발송

DynamoDB Tables
├── Users            # 사용자 정보
├── Templates        # 체크리스트 템플릿
├── CheckRecords     # 체크 기록
├── Assignments      # 배정 관리
└── AccessLogs       # 출입 로그

External Services
└── Amazon Q Developer # AI 판정 엔진
```

## 핵심 설계 원칙

### 1. 서버리스 우선 (Serverless First)
- **관리 부담 최소화**: 서버 관리 불필요
- **자동 스케일링**: 트래픽에 따른 자동 확장/축소
- **비용 효율성**: 사용한 만큼만 과금

### 2. 마이크로서비스 패턴
- **기능별 분리**: 각 Lambda 함수는 단일 책임
- **독립적 배포**: 기능별 독립적 개발/배포
- **장애 격리**: 한 서비스 장애가 전체에 영향 최소화

### 3. 이벤트 드리븐 아키텍처
- **비동기 처리**: DynamoDB Streams 활용
- **실시간 알림**: 상태 변경 시 즉시 알림
- **확장성**: 이벤트 기반 처리로 높은 처리량

### 4. 보안 우선 설계
- **최소 권한 원칙**: IAM 역할 기반 세밀한 권한 관리
- **데이터 암호화**: 전송/저장 시 암호화
- **API 보안**: JWT 토큰 + API 키 인증

## 데이터 흐름

### 0. 시스템 설정 및 배정 흐름 (사전 준비)
```
관리자 웹
    │ 1. 체크리스트 템플릿 생성
    ▼
API Gateway (/admin/templates)
    │ 2. 템플릿 저장 요청
    ▼
template-handler Lambda
    │ 3. 템플릿 데이터 저장
    ▼
DynamoDB (Templates)
    │ 4. 템플릿 저장 완료
    ▼
운영자 웹
    │ 5. 작업자별 템플릿 배정
    ▼
API Gateway (/operator/assignments)
    │ 6. 배정 설정 요청
    ▼
assignment-handler Lambda
    │ 7. 배정 및 스케줄 설정
    ▼
DynamoDB (Assignments)
    │ 8. 배정 정보 저장
```

### 1. 체크리스트 작성 및 AI 판정 흐름
```
작업자 모바일
    │ 1. 체크리스트 작성
    ▼
API Gateway (/checklist/submit)
    │ 2. 요청 라우팅
    ▼
checklist-handler Lambda
    │ 3. 데이터 검증 및 저장
    ▼
DynamoDB (CheckRecords)
    │ 4. 기록 저장
    ▼
ai-judgment-handler Lambda
    │ 5. AI 판정 요청
    ▼
Amazon Q Developer
    │ 6. AI 판정 결과
    ▼
qr-handler Lambda
    │ 7. QR 코드 생성
    ▼
작업자 모바일
    │ 8. 판정 결과 + QR 코드 표시
```

### 2. 실시간 모니터링 흐름
```
DynamoDB Streams
    │ 1. 데이터 변경 감지
    ▼
dashboard-handler Lambda
    │ 2. 현황 집계 업데이트
    ▼
운영자 대시보드
    │ 3. 실시간 현황 표시 (30초 폴링)
```

### 3. QR 코드 출입 통제 흐름 (해커톤 시연용)
```
작업자 QR 코드
    │ 1. QR 코드 스캔
    ▼
보안담당자 모바일 (카메라)
    │ 2. QR 데이터 전송
    ▼
API Gateway (/qr/verify)
    │ 3. 검증 요청
    ▼
qr-handler Lambda
    │ 4. QR 코드 검증
    ▼
DynamoDB (AccessLogs)
    │ 5. 출입 로그 기록
    ▼
보안담당자 화면
### 4. 책임자 팀 현황 모니터링 흐름
```
DynamoDB (CheckRecords, Assignments)
    │ 1. 팀별 데이터 조회
    ▼
dashboard-handler Lambda
    │ 2. 팀별 현황 집계
    ▼
책임자 모바일
    │ 3. 팀 완료율, 미완료자, 이상자 표시
    │ 4. 중요 알림 푸시 수신
```

### 전체 데이터 흐름 요약
```
1. 관리자: 템플릿 생성 → Templates 테이블
2. 운영자: 작업자 배정 → Assignments 테이블  
3. 작업자: 체크리스트 작성 → AI 판정 → QR 생성 → CheckRecords 테이블
4. 보안담당자: QR 스캔 → 출입 확인 → AccessLogs 테이블
5. 운영자/책임자: 실시간 현황 모니터링 (대시보드)
```

## 성능 및 확장성

### 성능 목표
- **AI 판정**: 5초 이내
- **대시보드 로딩**: 3초 이내
- **QR 코드 검증**: 2초 이내
- **동시 사용자**: 100명 (피크 시간)

### 확장성 전략
- **DynamoDB**: Auto Scaling 설정
- **Lambda**: 동시 실행 제한 관리
- **API Gateway**: 요청 제한 및 캐싱
- **CloudFront**: 정적 자원 CDN 배포

## 보안 설계 (해커톤 간소화 버전)

### 인증 및 권한 (간단한 방식)
```
사용자 인증 (해커톤용 간소화)
├── 간단한 로그인 (사용자명 + 역할 선택)
│   ├── 작업자 (worker)
│   ├── 운영자 (operator) 
│   ├── 책임자 (supervisor)
│   ├── 관리자 (admin)
│   └── 보안담당자 (security)
└── JWT 토큰 기반 세션 관리
    ├── 토큰에 사용자 ID + 역할 정보 포함
    ├── API 호출 시 토큰으로 권한 확인
    └── 8시간 자동 만료
```

### 해커톤용 간단한 인증 방식
- **복잡한 IAM 계정 생성 불필요**
- **AWS Cognito 대신 간단한 JWT 토큰 사용**
- **하드코딩된 사용자 목록** (데모용)
- **역할 기반 화면 분기** (프론트엔드에서 처리)

### 실제 운영 시 확장 계획
- **일동제약 AD 서버 연동** (Active Directory)
- **LDAP 인증** 또는 **SAML SSO** 연동
- **기존 사용자 계정 및 조직도 활용**
- **실제 부서/팀 정보 자동 동기화**

### 예시 사용자 목록 (해커톤 데모용)
```javascript
const DEMO_USERS = [
  { id: 'worker1', name: '김작업', role: 'worker', team: '생산팀A' },
  { id: 'operator1', name: '박운영', role: 'operator', team: '운영팀' },
  { id: 'supervisor1', name: '이책임', role: 'supervisor', team: '생산팀A' },
  { id: 'admin1', name: '최관리', role: 'admin', team: 'IT팀' },
  { id: 'security1', name: '정보안', role: 'security', team: '보안팀' }
];
```

### 실제 운영 시 사용자 정보 (AD 서버 연동)
```javascript
// AD 서버에서 자동 동기화될 정보
const AD_USER_EXAMPLE = {
  id: 'sjbaek',           // AD 계정명
  name: '백승재',          // 실명
  role: 'worker',         // 시스템 역할 (매핑)
  team: 'IT개발팀',        // AD 조직도 기반
  department: 'IT부',     // 부서 정보
  position: '대리',       // 직급
  email: 'sjbaek@ildong.com'
};
```

### 데이터 보안 (최소한)
- **전송 암호화**: HTTPS (기본)
- **저장 암호화**: DynamoDB 기본 암호화 (자동)
- **개인정보 보호**: 민감 데이터 최소화
- **접근 로그**: CloudWatch 기본 로깅

## 모니터링 및 로깅

### CloudWatch 메트릭
- **Lambda 함수**: 실행 시간, 오류율, 동시 실행 수
- **DynamoDB**: 읽기/쓰기 용량, 스로틀링
- **API Gateway**: 요청 수, 응답 시간, 4xx/5xx 오류

### 알림 설정
- **Critical**: 시스템 장애, 높은 오류율
- **Warning**: 성능 저하, 용량 부족
- **Info**: 일일 사용량 리포트

## 배포 전략

### 환경 분리
- **Development**: 개발 및 테스트
- **Staging**: 통합 테스트 및 검증
- **Production**: 실제 서비스 운영

### CI/CD 파이프라인
```
GitHub Repository
    │ 1. 코드 푸시
    ▼
GitHub Actions
    │ 2. 자동 빌드/테스트
    ▼
AWS SAM/Terraform
    │ 3. 인프라 배포
    ▼
AWS Lambda/S3
    │ 4. 애플리케이션 배포
```

## 비용 최적화

### 예상 비용 (월간, 100명 사용자 기준)
- **Lambda**: $10-20 (실행 시간 기반)
- **DynamoDB**: $5-15 (읽기/쓰기 용량)
- **API Gateway**: $3-10 (API 호출 수)
- **S3 + CloudFront**: $5-10 (정적 파일 호스팅)
- **총 예상 비용**: $25-60/월

### 비용 절약 전략
- **Lambda**: 메모리 최적화, 콜드 스타트 최소화
- **DynamoDB**: On-Demand vs Provisioned 선택
- **S3**: Lifecycle 정책으로 오래된 데이터 아카이브

## 장애 대응 및 복구

### 고가용성 설계
- **Multi-AZ**: DynamoDB 자동 복제
- **Lambda**: 여러 AZ에서 자동 실행
- **API Gateway**: AWS 관리형 서비스 (99.95% SLA)

### 장애 복구 계획
- **RTO (복구 시간 목표)**: 30분 이내
- **RPO (복구 지점 목표)**: 5분 이내
- **백업**: DynamoDB Point-in-Time Recovery 활성화

---
**설계자**: 백승재  
**검토자**: 풍기덕  
**승인일**: 2025-09-05  
**다음 업데이트**: API 명세서 및 데이터베이스 스키마 작성
