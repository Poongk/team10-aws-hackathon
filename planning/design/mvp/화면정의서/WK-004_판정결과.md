# WK-004: 판정 결과 화면

## 기본 정보
- **화면 ID**: WK-004
- **화면명**: 체크리스트 판정 결과
- **파일명**: `ChecklistResult.jsx`
- **사용자**: 작업자
- **접근경로**: 체크리스트 제출 후

## 와이어프레임

### 적합 판정 시 (유효한 QR)
```
┌─────────────────────────┐
│  ← [뒤로]     판정 결과  │ ← 헤더
├─────────────────────────┤
│                         │
│            ✅           │ ← 결과 아이콘
│                         │
│      위생상태 점검 완료! │ ← 결과 메시지
│     안전하게 작업하세요  │
│                         │
│  ┌─────────────────┐    │
│  │                 │    │
│  │ [실제 QR 코드]   │    │ ← 실제 QR 코드 (200×200)
│  │ 김철수 (EMP001)  │    │
│  │ 출입허용         │    │
│  │                 │    │
│  └─────────────────┘    │
│                         │
│     유효시간: 29분 45초  │ ← 실시간 타이머
│          남음           │
│                         │
├─────────────────────────┤
│   [ 대시보드로 돌아가기 ] │ ← 단일 액션 버튼
└─────────────────────────┘
```

### 적합 판정 시 (만료된 QR)
```
┌─────────────────────────┐
│  ← [뒤로]     판정 결과  │ ← 헤더
├─────────────────────────┤
│                         │
│            ✅           │ ← 결과 아이콘
│                         │
│      위생상태 점검 완료! │ ← 결과 메시지
│     안전하게 작업하세요  │
│                         │
│  ┌─────────────────┐    │
│  │                 │    │
│  │ [회색 QR 코드]   │    │ ← 만료된 QR (회색 필터)
│  │    만료됨        │    │ ← 만료 오버레이
│  │                 │    │
│  └─────────────────┘    │
│                         │
│         만료됨          │ ← 만료 상태 표시
│                         │
├─────────────────────────┤
│   [ 대시보드로 돌아가기 ] │ ← 단일 액션 버튼
└─────────────────────────┘
```

### 부적합 판정 시
```
┌─────────────────────────┐
│  ← [뒤로]     판정 결과  │ ← 헤더
├─────────────────────────┤
│                         │
│            ❌           │ ← 결과 아이콘
│                         │
│       건강상 이유로 오늘은│ ← 결과 메시지
│      출근이 어렵습니다   │
│                         │
│  ┌─────────────────┐    │
│  │         🏥      │    │
│  │                 │    │ ← 안내 카드
│  │   보건실에서 상담│    │
│  │   받으신 후 출입 │    │
│  │   해주세요       │    │
│  │                 │    │
│  └─────────────────┘    │
│                         │
├─────────────────────────┤
│      [재검사하기]        │ ← 액션 버튼
│   [ 대시보드로 돌아가기 ] │
└─────────────────────────┘
```

## 주요 구성요소

### URL 파라미터 지원 (신규)
```
/mvp/result?user=김철수&userId=EMP001&approved=true&expired=false
```
- **user**: 사용자명 (김철수)
- **userId**: 사용자ID (EMP001)  
- **approved**: 적합여부 (true/false)
- **expired**: 만료여부 (true/false)

### 헤더
- 뒤로가기 버튼 (체크리스트로)
- 제목: "판정 결과"

### 결과 표시 영역

#### 적합 판정 (approved=true)
- **아이콘**: ✅ (64px 녹색 체크)
- **메시지**: "위생상태 점검 완료! 안전하게 작업하세요"
- **실제 QR 코드**: qrcode 라이브러리로 생성 (200×200px)
- **QR 내용**: 이름, 사번, 출입허용/만료됨, 점검시간, 만료시간
- **실시간 타이머**: 30분 카운트다운 (5분 이하 시 빨간색 경고)

#### 만료된 QR (approved=true, expired=true)
- **회색 필터**: `filter: grayscale(100%) opacity(0.5)`
- **만료 오버레이**: "만료됨" 텍스트 중앙 표시
- **타이머**: "만료됨" 고정 표시

#### 부적합 판정 (approved=false)
- **아이콘**: ❌ (64px 빨간색 X)
- **메시지**: 부적합 사유별 맞춤 메시지
- **안내 카드**: 🏥 아이콘 + 조치 방법
- **QR 코드**: 생성되지 않음

### 액션 버튼 영역 (수정됨)

#### 적합 시
- **대시보드로 돌아가기**: WK-002로 이동 (단일 버튼)

#### 부적합 시
- **재검사하기**: WK-003 체크리스트로 이동
- **대시보드로 돌아가기**: WK-002로 이동

## 기능 명세

### QR 코드 생성 (실제 구현)
```javascript
const generateQRCode = async (userData, isExpired = false) => {
  const qrData = {
    name: userData.name,           // 김철수
    employeeId: userData.user_id,  // EMP001
    status: isExpired ? '만료됨' : '출입허용',
    checkTime: new Date().toLocaleString('ko-KR'),
    expireTime: new Date(Date.now() + 30*60*1000).toLocaleString('ko-KR')
  };

  const qrText = `${qrData.name} (${qrData.employeeId})\n${qrData.status}\n점검시간: ${qrData.checkTime}\n만료시간: ${qrData.expireTime}`;
  
  return await QRCode.toDataURL(qrText, {
    width: 200,
    margin: 2,
    color: { dark: '#000000', light: '#FFFFFF' }
  });
};
```

### 실시간 타이머
```javascript
const [timeLeft, setTimeLeft] = useState(30 * 60); // 30분

useEffect(() => {
  const timer = setInterval(() => {
    setTimeLeft(prev => prev > 0 ? prev - 1 : 0);
  }, 1000);
  
  return () => clearInterval(timer);
}, []);

const formatTime = (seconds) => {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}분 ${secs}초 남음`;
};
```

### 하위 호환성
- **파라미터 있음**: URL 파라미터 기반 처리
- **파라미터 없음**: 기존 localStorage 방식 사용

## UI 요구사항

### QR 코드 스타일
```css
.qr-container {
  background: white;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  position: relative;
}

.qr-container.expired .qr-image {
  filter: grayscale(100%) opacity(0.5);
}

.expired-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 600;
}
```

### 타이머 경고 스타일
```css
.timer.warning {
  color: #ef4444;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
```

## 부적합 메시지 목록

### 증상 관련
- **발열/설사/구토**: "충분한 휴식 후 내일 다시 체크해주세요 🏠"
- **호흡기 질환**: "호흡기 증상이 있습니다.\n충분한 휴식을 취하세요"

### 상처 관련
- **신체 상처**: "🏥 보건실에서 상담 받으신 후 출입해주세요"

### 복장 관련
- **작업복**: "작업복 상태를 다시 확인해주세요 👔"
- **장신구**: "장신구를 제거한 후 다시 체크해주세요"
- **두발**: "두발 상태를 정리한 후 다시 체크해주세요"
- **손톱**: "손톱을 깨끗이 한 후 다시 체크해주세요"
- **화장**: "화장을 연하게 한 후 다시 체크해주세요"

### 물품 관련
- **개인물품**: "작업용 이외의 물품을 제거해주세요"

## 참고 문서
- **실제 구현**: WorkerResult.jsx
- **QR 라이브러리**: qrcode npm package
- **URL 파라미터**: 체크리스트 제출 시 자동 생성
- **이전 화면**: WK-003 체크리스트 작성

---
**작성일**: 2025-09-06  
**상태**: 개발 완료 ✅  
**업데이트**: URL 파라미터 지원, 실제 QR 생성, 만료 상태 처리, 버튼 간소화

## 주요 구성요소

### 헤더
- 뒤로가기 버튼 (체크리스트로)
- 제목: "판정 결과"

### 결과 표시 영역

#### 적합 판정
- **아이콘**: ✅ (큰 녹색 체크)
- **메시지**: "위생상태 점검 완료! 안전하게 작업하세요"
- **QR 코드**: 200×200px 크기
- **유효시간**: 실시간 카운트다운

#### 부적합 판정
- **아이콘**: ❌ (큰 빨간색 X)
- **메시지**: 부적합 사유별 맞춤 메시지
- **안내 카드**: 조치 방법 안내
- **QR 코드**: 생성되지 않음

### 액션 버튼 영역

#### 적합 시
- **QR 코드 보기**: WK-005 QR 표시 화면으로
- **대시보드로 돌아가기**: WK-002로 이동

#### 부적합 시
- **재검사하기**: WK-003 체크리스트로 이동
- **대시보드로 돌아가기**: WK-002로 이동

## 기능 명세

### 판정 로직
```javascript
const determineResult = (checklistData) => {
  // 모든 항목이 적합이어야 통과
  const allPassed = checklistData.every(item => 
    item.result === 'approved' || item.result === '예'
  );
  
  return allPassed ? 'approved' : 'rejected';
};
```

### QR 코드 생성
```javascript
const generateQRCode = (userData) => {
  const qrData = {
    user_id: userData.employeeId,
    name: userData.name,
    check_time: new Date().toISOString(),
    expire_time: new Date(Date.now() + 30*60*1000).toISOString(),
    status: 'approved',
    ai_verified: userData.aiVerified || false
  };
  
  return QRCode.generate(JSON.stringify(qrData));
};
```

### 타이머 기능
```javascript
const [timeLeft, setTimeLeft] = useState(30 * 60); // 30분

useEffect(() => {
  const timer = setInterval(() => {
    setTimeLeft(prev => prev > 0 ? prev - 1 : 0);
  }, 1000);
  
  return () => clearInterval(timer);
}, []);

const formatTime = (seconds) => {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}분 ${secs}초 남음`;
};
```

## 부적합 메시지 목록

### 증상 관련
- **발열/설사/구토**: "충분한 휴식 후 내일 다시 체크해주세요 🏠"
- **호흡기 질환**: "호흡기 증상이 있습니다. 충분한 휴식을 취하세요"

### 상처 관련 (AI 판별)
- **염증 상처**: "🏥 보건실에서 상담 받으신 후 출입해주세요"

### 복장 관련
- **작업복**: "작업복 상태를 다시 확인해주세요 👔"
- **장신구**: "장신구를 제거한 후 다시 체크해주세요"
- **두발**: "두발 상태를 정리한 후 다시 체크해주세요"
- **손톱**: "손톱을 깨끗이 한 후 다시 체크해주세요"
- **화장**: "화장을 연하게 한 후 다시 체크해주세요"

### 물품 관련
- **개인물품**: "작업용 이외의 물품을 제거해주세요"

## UI 요구사항

### 색상 구분
- **적합**: 녹색 계열 (#10b981)
- **부적합**: 빨간색 계열 (#ef4444)
- **배경**: 결과에 따른 연한 색상

### 아이콘 크기
- 결과 아이콘: 64px × 64px
- 안내 아이콘: 32px × 32px

### QR 코드 스타일
- 크기: 200px × 200px
- 테두리: 흰색 배경 + 회색 테두리
- 여백: 충분한 스캔 공간

### 타이머 스타일
- 폰트: 모노스페이스
- 크기: 16px
- 색상: 회색 → 5분 이하 시 빨간색

## 참고 문서
- **상세분석**: 판정 결과 메시지, 최종 판정 규칙
- **시연시나리오**: 시나리오 1~4의 판정 결과 단계
- **사용자스토리**: US-006 적합 판정, US-007 부적합 판정

---
**작성일**: 2025-09-06  
**상태**: 개발 준비 완료
