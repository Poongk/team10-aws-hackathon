# AD-002: QR 스캐너 화면

## 기본 정보
- **화면 ID**: AD-002
- **화면명**: QR 코드 스캐너
- **파일명**: `QRScanner.jsx`
- **사용자**: 관리자
- **접근경로**: 관리자 로그인 직후 자동 표시

## 와이어프레임
```
┌─────────────────────────────────┐
│  QR 스캐너        [로그아웃]    │ ← 헤더
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────────┐ │
│  │                             │ │
│  │     📷 QR 스캐너            │ │ ← 스캐너 영역
│  │                             │ │
│  │    QR 코드를 화면에         │ │
│  │      맞춰주세요             │ │
│  │                             │ │
│  └─────────────────────────────┘ │
│                                 │
├─────────────────────────────────┤
│                                 │
│  ✅ 출입 허용 - 김철수님        │ ← 스캔 결과
│     2025-09-06 08:15           │
│                                 │
├─────────────────────────────────┤
│                                 │
│        📊 최근 출입 로그        │ ← 로그 섹션
│                                 │
│  ✅ 08:15 김철수 (출입허용)     │
│  ✅ 08:12 이영희 (AI검증완료)   │
│  ❌ 08:10 박민수 (만료된코드)   │
│  ✅ 08:08 정수연 (출입허용)     │
│  ❌ 08:05 최수진 (부적합)       │
│                                 │
└─────────────────────────────────┘
```

## 주요 구성요소

### 헤더
- 제목: "QR 스캐너"
- 로그아웃 버튼 (우측 상단)

### QR 스캐너 영역
- **카메라 뷰파인더**: 실시간 QR 스캔
- **가이드 메시지**: "QR 코드를 화면에 맞춰주세요"
- **스캔 가이드**: 점선 사각형 오버레이

### 스캔 결과 표시
- **성공 시**: 녹색 배경 + 체크 아이콘
- **실패 시**: 빨간색 배경 + X 아이콘
- **사용자 정보**: 이름, 시간 표시
- **자동 사라짐**: 3초 후 다음 스캔 대기

### 출입 로그 (최근 10건)
- **시간순 정렬**: 최신 순
- **상태별 아이콘**: ✅ 허용, ❌ 거부
- **실시간 업데이트**: 새 스캔 시 자동 추가

## 기능 명세

### QR 스캔 처리
```javascript
const handleQRScan = async (qrData) => {
  try {
    const result = await validateQRCode(qrData);
    setLastScanResult(result);
    addToLog(result);
    
    // 3초 후 결과 초기화
    setTimeout(() => {
      setLastScanResult(null);
    }, 3000);
    
  } catch (error) {
    setLastScanResult({
      status: 'error',
      message: '유효하지 않은 QR 코드입니다'
    });
  }
};
```

### QR 코드 검증
```javascript
const validateQRCode = (qrData) => {
  const data = JSON.parse(qrData);
  const now = new Date();
  const expireTime = new Date(data.expire_time);
  
  if (now > expireTime) {
    return {
      status: 'expired',
      message: '만료된 코드입니다. 재검사 필요',
      user: data.name
    };
  }
  
  if (data.status === 'approved') {
    return {
      status: 'approved',
      message: `출입 허용 - ${data.name}님`,
      user: data.name,
      aiVerified: data.ai_verified
    };
  }
  
  return {
    status: 'rejected',
    message: '출입이 거부되었습니다',
    user: data.name
  };
};
```

### 출입 로그 관리
```javascript
const [accessLog, setAccessLog] = useState([]);

const addToLog = (result) => {
  const logEntry = {
    id: Date.now(),
    time: new Date().toLocaleTimeString('ko-KR', { 
      hour: '2-digit', 
      minute: '2-digit' 
    }),
    user: result.user,
    status: result.status,
    message: result.message
  };
  
  setAccessLog(prev => [logEntry, ...prev.slice(0, 9)]);
};
```

## 스캔 결과 메시지

### 성공 케이스
- **일반 허용**: "✅ 출입 허용 - {이름}님"
- **AI 검증**: "✅ 출입 허용 (AI 검증 완료) - {이름}님"

### 실패 케이스
- **만료**: "❌ 만료된 코드입니다. 재검사 필요"
- **무효**: "❌ 유효하지 않은 QR 코드입니다"
- **부적합**: "❌ 출입이 거부되었습니다"

### 오류 케이스
- **스캔 실패**: "❌ QR 코드를 인식할 수 없습니다"
- **네트워크 오류**: "❌ 서버 연결에 실패했습니다"

## UI 요구사항

### 스캐너 영역
- 크기: 280px × 280px
- 테두리: 점선 사각형 가이드
- 배경: 반투명 어두운 오버레이
- 가이드: 중앙 정렬

### 결과 표시
- **성공**: 녹색 배경 (#10b981)
- **실패**: 빨간색 배경 (#ef4444)
- **경고**: 노란색 배경 (#f59e0b)
- 애니메이션: 페이드인/아웃

### 로그 스타일
- 항목 높이: 48px
- 아이콘: 16px × 16px
- 시간: 모노스페이스 폰트
- 구분선: 연한 회색

### 반응형 처리
- 모바일: 세로 레이아웃
- 스캐너 우선 배치
- 로그는 스크롤 가능

## 성능 요구사항

### 스캔 성능
- **응답 시간**: 1초 이내
- **연속 스캔**: 3초 간격 제한
- **메모리 관리**: 로그 최대 50개 유지

### 카메라 최적화
- **해상도**: 720p (성능 최적화)
- **프레임률**: 15fps
- **자동 포커스**: 활성화

## 오류 처리

### 카메라 권한
```
❌ 카메라 권한이 필요합니다
설정에서 카메라 권한을 허용해주세요

[설정으로 이동] [새로고침]
```

### 네트워크 오류
```
❌ 서버 연결에 실패했습니다
네트워크 연결을 확인해주세요

[다시 시도]
```

## 참고 문서
- **시연시나리오**: 모든 시나리오의 "출입 과정" 단계
- **사용자스토리**: US-009 관리자 QR 스캐너, US-010 QR 스캔 판정, US-011 출입 로그
- **상세분석**: QR 코드 구조, 스캐너 응답 메시지

---
**작성일**: 2025-09-06  
**상태**: 개발 준비 완료
