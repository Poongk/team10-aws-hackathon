# WK-005: 결과 보기 화면

## 기본 정보
- **화면 ID**: WK-005
- **화면명**: 이전 결과 조회
- **파일명**: `ResultHistory.jsx`
- **사용자**: 작업자
- **접근경로**: 대시보드 → "결과 보기"

## 와이어프레임

### 결과 목록 화면 (최신 순 정렬)
```
┌─────────────────────────┐
│  ← [뒤로]     결과 보기  │ ← 헤더
├─────────────────────────┤
│                         │
│  📊 최근 체크리스트 결과 │ ← 제목
│                         │
├─────────────────────────┤
│                         │
│  ┌─────────────────┐    │
│  │ 2025-09-06 08:15│    │ ← 최신 결과 (김철수)
│  │ ✅ 적합 판정     │    │
│  │                 │    │
│  │ [  QR코드 확인  ]│    │ ← 단일 액션 버튼
│  │                 │    │
│  │ 상태: 유효함     │    │ ← 상태 표시 (QR 없음)
│  │ (25분 남음)     │    │
│  └─────────────────┘    │
│                         │
│  ┌─────────────────┐    │
│  │ 2025-09-05 08:20│    │ ← 부적합 결과 (이영희)
│  │ ❌ 부적합 판정   │    │
│  │                 │    │
│  │ 사유: 발열 증상  │    │
│  │ 확인            │    │
│  │ QR 코드 없음    │    │
│  └─────────────────┘    │
│                         │
│  ┌─────────────────┐    │
│  │ 2025-09-04 09:10│    │ ← 만료된 결과 (박민수)
│  │ ✅ 적합 판정     │    │
│  │                 │    │
│  │ [  QR코드 확인  ]│    │ ← 만료된 QR로 이동
│  │                 │    │
│  │ 상태: 만료됨     │    │
│  └─────────────────┘    │
│                         │
├─────────────────────────┤
│    [새 체크리스트 작성]  │ ← 액션 버튼
└─────────────────────────┘
```

### 빈 상태 화면
```
┌─────────────────────────┐
│  ← [뒤로]     결과 보기  │ ← 헤더
├─────────────────────────┤
│                         │
│  📊 최근 체크리스트 결과 │ ← 제목
│                         │
├─────────────────────────┤
│                         │
│         📋             │ ← 빈 상태 아이콘
│                         │
│   아직 체크리스트 결과가 │
│      없습니다           │
│                         │
│  첫 번째 위생상태 점검을 │
│    시작해보세요         │
│                         │
│  ┌─────────────────┐    │
│  │ 체크리스트 작성하기│    │ ← 액션 버튼
│  └─────────────────┘    │
│                         │
└─────────────────────────┘
```

## 주요 구성요소

### 헤더
- 뒤로가기 버튼 (대시보드로)
- 제목: "결과 보기"

### 결과 목록 (수정됨)
- **정렬 순서**: 최신 순 (날짜 기준 내림차순)
- **다중 사용자**: 김철수, 이영희, 박민수 등 여러 사용자 결과
- **QR 코드 제거**: QR 이미지 표시하지 않음
- **카드 형태**: 각 결과를 독립적인 카드로 표시

### 결과 카드 구성

#### 적합 판정 카드 (유효)
- **날짜/시간**: "2025-09-06 08:15"
- **판정 결과**: "✅ 적합 판정"
- **QR코드 확인 버튼**: 전체 너비 파란색 버튼
- **상태 표시**: "상태: 유효함 (25분 30초 남음)"

#### 적합 판정 카드 (만료)
- **날짜/시간**: "2025-09-04 09:10"
- **판정 결과**: "✅ 적합 판정"
- **QR코드 확인 버튼**: 만료된 QR로 이동
- **상태 표시**: "상태: 만료됨"

#### 부적합 판정 카드
- **날짜/시간**: "2025-09-05 08:20"
- **판정 결과**: "❌ 부적합 판정"
- **부적합 사유**: "사유: 발열 증상 확인"
- **QR 없음**: "QR 코드 없음" 표시

### 액션 버튼 영역
- **새 체크리스트 작성**: WK-003으로 이동

## 기능 명세

### 결과 데이터 구조 (수정됨)
```javascript
const mockResults = [
  {
    id: 1,
    date: '2025-09-06T08:15:00Z',
    status: 'approved',
    userName: '김철수',    // 사용자명 추가
    userId: 'EMP001',     // 사용자ID 추가
    expireTime: new Date(Date.now() + 30*60*1000).toISOString(),
    isExpired: false,
    aiVerified: true
  },
  {
    id: 2,
    date: '2025-09-05T08:20:00Z',
    status: 'rejected',
    userName: '이영희',    // 다른 사용자
    userId: 'EMP002',
    reason: '발열 증상 확인'
  },
  {
    id: 3,
    date: '2025-09-04T09:10:00Z',
    status: 'approved',
    userName: '박민수',    // 또 다른 사용자
    userId: 'EMP003',
    expireTime: '2025-09-04T09:40:00Z',
    isExpired: true
  }
];
```

### URL 파라미터 전달 (신규)
```javascript
const handleViewResult = (result) => {
  const params = new URLSearchParams({
    user: result.userName,     // 각 결과의 사용자명
    userId: result.userId,     // 각 결과의 사용자ID
    approved: result.status === 'approved' ? 'true' : 'false',
    expired: result.isExpired ? 'true' : 'false'
  });
  
  navigate(`/mvp/result?${params.toString()}`);
};
```

### 최신 순 정렬 (신규)
```javascript
const loadResultHistory = () => {
  // 최신 순으로 정렬 (날짜 기준 내림차순)
  const sortedResults = mockResults.sort((a, b) => 
    new Date(b.date) - new Date(a.date)
  );
  setResultHistory(sortedResults);
};
```

### 실시간 타이머
```javascript
const calculateTimeLeft = (expireTime) => {
  const now = new Date();
  const expire = new Date(expireTime);
  const diff = expire - now;
  
  if (diff <= 0) return '만료됨';
  
  const minutes = Math.floor(diff / 60000);
  const seconds = Math.floor((diff % 60000) / 1000);
  return `${minutes}분 ${seconds}초 남음`;
};
```

## UI 요구사항

### 카드 스타일 (간소화)
```css
.result-card {
  background: white;
  border: 1px solid #f0f0f0;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}
```

### QR코드 확인 버튼 (수정됨)
```css
.view-result-button {
  width: 100%;
  padding: 12px 16px;
  background: #1890ff;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
}
```

### 상태별 색상
- **적합**: 녹색 (#10b981)
- **부적합**: 빨간색 (#ef4444)
- **만료**: 회색 (#8c8c8c)

## 상호작용 정의

### QR코드 확인 버튼 클릭 (수정됨)
- **기능**: 해당 사용자의 판정 결과 화면으로 이동
- **URL**: `/mvp/result?user=김철수&userId=EMP001&approved=true&expired=false`
- **유효한 QR**: 정상 QR 코드 표시
- **만료된 QR**: 회색 필터 + "만료됨" 오버레이

### 새 체크리스트 작성
- **기능**: WK-003 체크리스트 작성 화면으로 이동
- **위치**: 하단 고정 버튼

## 참고 문서
- **실제 구현**: WorkerResults.jsx
- **URL 파라미터**: 각 결과별 사용자 정보 전달
- **QR 제거**: QR 이미지 표시하지 않음, 버튼으로만 접근
- **다음 화면**: WK-004 판정 결과 (파라미터 기반)

---
**작성일**: 2025-09-06  
**상태**: 개발 완료 ✅  
**업데이트**: QR 코드 제거, 최신 순 정렬, 다중 사용자 지원, URL 파라미터 전달

## 기능 명세

### 결과 데이터 구조
```javascript
const resultHistory = [
  {
    id: 1,
    date: '2025-09-06T08:15:00Z',
    status: 'approved',
    qrCode: 'data:image/png;base64...',
    expireTime: '2025-09-06T08:45:00Z',
    isExpired: false,
    aiVerified: true
  },
  {
    id: 2,
    date: '2025-09-05T08:20:00Z',
    status: 'rejected',
    reason: '발열 증상 확인',
    qrCode: null
  }
];
```

### 만료시키기 기능 (시연용)
```javascript
const expireQRCode = (resultId) => {
  setResultHistory(prev => 
    prev.map(result => 
      result.id === resultId 
        ? { ...result, isExpired: true, expireTime: new Date().toISOString() }
        : result
    )
  );
};
```

### 실시간 타이머
```javascript
const calculateTimeLeft = (expireTime) => {
  const now = new Date();
  const expire = new Date(expireTime);
  const diff = expire - now;
  
  if (diff <= 0) return '만료됨';
  
  const minutes = Math.floor(diff / 60000);
  const seconds = Math.floor((diff % 60000) / 1000);
  return `${minutes}분 ${seconds}초 남음`;
};
```

### QR 상태 관리
```javascript
const getQRStatus = (result) => {
  if (!result.qrCode) return null;
  
  if (result.isExpired) {
    return {
      status: 'expired',
      text: '만료됨',
      color: 'gray'
    };
  }
  
  const timeLeft = calculateTimeLeft(result.expireTime);
  return {
    status: 'valid',
    text: `유효함 (${timeLeft})`,
    color: 'green'
  };
};
```

## UI 요구사항

### 카드 스타일
- 배경: 흰색
- 테두리: 연한 회색
- 둥근 모서리: 12px
- 그림자: 약간의 드롭 섀도우
- 간격: 카드 간 16px

### 상태별 색상
- **적합**: 녹색 (#10b981)
- **부적합**: 빨간색 (#ef4444)
- **만료**: 회색 (#6b7280)

### QR 코드 표시
- **유효**: 정상 색상
- **만료**: 회색 필터 + "만료됨" 오버레이
- 크기: 200×150px (카드 내 적절한 크기)

### 만료시키기 버튼
- 크기: 작은 버튼 (80px)
- 색상: 빨간색 (#ef4444)
- 위치: QR 코드 우측 상단
- 텍스트: "만료시키기"

### 빈 상태 처리
```
📋 아직 체크리스트 결과가 없습니다

첫 번째 위생상태 점검을 시작해보세요

[체크리스트 작성하기]
```

## 상호작용 정의

### QR 코드 클릭
- 유효한 QR: 확대 보기 모달
- 만료된 QR: 클릭 불가 (회색 처리)

### 만료시키기 버튼
- 클릭 시 확인 다이얼로그
- 확인 후 즉시 만료 처리
- QR 코드 회색 처리 + "만료됨" 표시

### 카드 스와이프 (선택사항)
- 좌측 스와이프: 삭제 옵션
- 우측 스와이프: 상세 보기

## 오류 처리

### 데이터 로딩 실패
```
❌ 결과를 불러올 수 없습니다
네트워크 연결을 확인해주세요

[다시 시도]
```

### 만료 처리 실패
```
❌ 처리에 실패했습니다
잠시 후 다시 시도해주세요
```

## 참고 문서
- **시연시나리오**: 시나리오 5 "결과 보기 페이지"
- **사용자스토리**: US-008 이전 결과 조회
- **공통정의서**: 카드 컴포넌트, 상태 표시

---
**작성일**: 2025-09-06  
**상태**: 개발 준비 완료
